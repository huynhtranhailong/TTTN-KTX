function parseDate(t){var e=t.split("/"),n=new Date(e[2],e[1]-1,e[0]);return isNaN(n.getTime())?null:n}$(document).ready(function(){JSON.parse($("#data").val()),$("#infoTable").DataTable({responsive:!0,bLengthChange:!1,language:{url:"//cdn.datatables.net/plug-ins/1.10.15/i18n/Vietnamese.json"}});$("select[name='registerTime']").change(function(){var t={registerList:$("select[name='registerTime']").val()};$.post("/admin/getReglist",t,function(t){$("input[name='registerId']").val(t._id),$("#infoTable > tbody").empty(),$.each(t.listUser,function(t,e){var n="<tr data-id="+e._id+"><td>"+(t+1)+"</td><td class='popInfo'>"+e.user.id+"</td><td style='text-align: left'>"+e.user.name.familyName+"</td><td>"+e.user.name.givenName+"</td><td>"+(e.user.details.gender?"Nam":"Nữ")+"</td><td>"+moment(e.user.details.birthday).format("DD/MM/YYYY")+"</td><td>"+e.user.details.birthplace+"</td><td>"+moment(e.date).format("DD/MM/YYYY, HH:mm")+"</td>";"1"==e.status?n+="<td> <i class='glyphicon glyphicon-remove toggleStay'></i> <i class='glyphicon glyphicon-map-marker'></i></td>":n+="<td> <i class='glyphicon glyphicon-ok toggleStay'></i> <i class='glyphicon glyphicon-map-marker'></i></td>",n+="</tr>",$("#infoTable > tbody").append(n),$(".toggleStay").unbind(),$(".toggleStay").click(function(){var t=$(this),e={rowId:t.parent().parent().data("id"),registerId:$("input[name='registerId']").val()},n=t.parents("tr").eq(0).children().eq(2).text()+" "+t.parents("tr").eq(0).children().eq(3).text(),a="Bạn đang duyệt cho sinh viên "+n+" lưu trú (không xếp phòng)",i="DUYỆT";t.hasClass("glyphicon-remove")&&(a="Bạn đang bỏ duyệt cho sinh viên "+n,i="BỎ DUYỆT"),$.confirm({title:"DUYỆT LƯU TRÚ",content:a,buttons:{OK:{btnClass:"btn-blue",text:i,action:function(){$.post("/admin/updateReglist",e,function(e){1==e.status||$.alert("Đã có lỗi xảy ra"),t.hasClass("glyphicon-remove")?(t.removeClass("glyphicon-remove"),t.addClass("glyphicon-ok")):(t.removeClass("glyphicon-ok"),t.addClass("glyphicon-remove"))})}},cancel:{text:"Hủy bỏ",action:function(){}}}})}),$(".popInfo").unbind(),$(".popInfo").click(function(){var t={rowId:$(this).parent().data("id"),registerId:$("input[name='registerId']").val()};$.post("/admin/viewInfo",t,function(t){var e=t;$.confirm({title:"THÔNG TIN SINH VIÊN ",content:"<p><label>Họ tên sinh viên: </label> "+e.name.familyName+" "+e.name.givenName+"</p><p><label>MSSV: </label> "+e.id+"<p><label>Email: </label> "+e.email+"<p><label>Địa chỉ thường trú: </label> "+e.details.temporaryAddress.details+"<p><label>CMND: </label> "+e.details.identityCard.id+"<p><label>Dân tộc: </label> "+e.details.ethnicity+"<p><label>Tôn giáo: </label> "+e.details.religion+"<p><label>Số điện thoại: </label> "+e.details.phone,buttons:{OK:{text:"Đóng",action:function(){}}}})})})})})}),$(".toggleStay").click(function(){var t=$(this),e={rowId:t.parent().parent().data("id"),registerId:$("input[name='registerId']").val()},n=t.parents("tr").eq(0).children().eq(2).text()+" "+t.parents("tr").eq(0).children().eq(3).text(),a="Bạn đang duyệt cho sinh viên "+n+" lưu trú (không xếp phòng)",i="DUYỆT";t.hasClass("glyphicon-remove")&&(a="Bạn đang bỏ duyệt cho sinh viên "+n,i="BỎ DUYỆT"),$.confirm({title:"DUYỆT LƯU TRÚ",content:a,buttons:{OK:{btnClass:"btn-blue",text:i,action:function(){$.post("/admin/updateReglist",e,function(e){1==e.status||$.alert("Đã có lỗi xảy ra"),t.hasClass("glyphicon-remove")?(t.removeClass("glyphicon-remove"),t.addClass("glyphicon-ok")):(t.removeClass("glyphicon-ok"),t.addClass("glyphicon-remove"))})}},cancel:{text:"Hủy bỏ",action:function(){}}}})}),$(".popInfo").click(function(){var t={rowId:$(this).parent().data("id"),registerId:$("input[name='registerId']").val()};$.post("/admin/viewInfo",t,function(t){var e=t;$.confirm({title:"THÔNG TIN SINH VIÊN ",content:"<p><label>Họ tên sinh viên: </label> "+e.name.familyName+" "+e.name.givenName+"</p><p><label>MSSV: </label> "+e.id+"<p><label>Email: </label> "+e.email+"<p><label>Địa chỉ thường trú: </label> "+e.details.temporaryAddress.details+"<p><label>CMND: </label> "+e.details.identityCard.id+"<p><label>Dân tộc: </label> "+e.details.ethnicity+"<p><label>Tôn giáo: </label> "+e.details.religion+"<p><label>Số điện thoại: </label> "+e.details.phone,buttons:{OK:{text:"Đóng",action:function(){}}}})})}),$("#finish").click(function(){$(this);var t=$("input[name='registerId']").val();$.confirm({title:"DUYỆT LƯU TRÚ",content:"Bạn có chắc chắn kết thúc việc duyệt lưu trú?",buttons:{OK:{btnClass:"btn-blue",text:"XÁC NHẬN",action:function(){$.post("/admin/confirmStay",{data:t},function(t){1==t.status?$.alert("Xét duyệt thành công"):alert("Error")})}},CANCEL:{text:"HỦY BỎ",action:function(){}}}})}),$("#export").click(function(){$(this);var t=$("input[name='registerId']").val();$.confirm({title:"DUYỆT LƯU TRÚ",content:"Xuất danh sách duyệt lưu trú đợt này?",buttons:{OK:{btnClass:"btn-blue",text:"XÁC NHẬN",action:function(){$.post("/admin/exportFile",{data:t},function(t){1==t.status&&window.location.replace(t.link)})}},CANCEL:{text:"HỦY BỎ",action:function(){}}}})})});